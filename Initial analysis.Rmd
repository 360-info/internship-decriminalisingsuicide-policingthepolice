---
title: "De-Criminalizing Suicide:  Visualizations"
author: "Nishtha Arora"
output: html_document
date: "2023-03-19"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, fig.width=12, fig.height=8)
```

# Visualization 1

## WORLD SUICIDE RATE'S COMPARISON WITH DEVELOPMENT STATUS.

### Data sources 
1.Worldwide suicide rates OWID (filtering from 2000-2019, i.e. 10 years)
https://ourworldindata.org/suicide

2.HDI Data-UNDP-  Values recorded in 2021, rank (2020).
http://hdr.undp.org/en/composite/HDI


```{r libraries}
library(readr)
library(themes360info)
library(readxl)
library(tidyverse)
library(hrbrthemes)
library(ggthemes)
library(lubridate)
library(sf)
library(rgeos)
```

```{r cleaning}
read_data <- function(range, development_status) {
  read_excel(
    "data/InitialA1/HDIstatus.xlsx", range = range, col_names = FALSE) %>%
    rename(
      HDI_rank_2021 = ...1,
      Country = ...2,
      HDI_Value = ...3,
      Life_expectancy = ...5,
      Expected_years_of_schooling = ...7,
      Mean_years_of_schooling = ...9,
      GNI_per_capita = ...11,
      GNI_rank_minus_HDI_rank = ...13,
      HDI_rank_2020 = ...15
    ) %>%
  select(
    HDI_rank_2021, Country, HDI_Value,
    Life_expectancy, Expected_years_of_schooling,
    Mean_years_of_schooling, GNI_per_capita,
    GNI_rank_minus_HDI_rank, HDI_rank_2020
  ) %>%
  mutate(Degree_of_Human_Development = development_status)
}

very_high_hdi <-
  read_data("A9:O74", "VERY HIGH HUMAN DEVELOPMENT")

high_hdi <-
  read_data("A76:O128", "HIGH HUMAN DEVELOPMENT")

medium_hdi <-
  read_data("A130:O166", "MEDIUM HUMAN DEVELOPMENT")

low_hdi <-
  read_data("A168:O200", "LOW HUMAN DEVELOPMENT")

hdi <- bind_rows(very_high_hdi, high_hdi, medium_hdi, low_hdi)

write_csv(hdi, "data/InitialA1/HDIStatus2.csv")
```

```{r saving_cleaned_data}
tidied_hdi_data <- read_csv("data/InitialA1/HDIStatus2.csv") %>%
  rename("Entity" = Country)
```

```{r reading data_suicides}
suicide_rates <- read_csv("data/InitialA1/suicide-death-rates.csv")
```

```{r matching_column_names}
# setdiff(data2$Entity, data3$Entity)

# rename countries to align with other dataset
change <- suicide_rates %>%
  mutate(Entity = recode(Entity,
    "American Samoa" = "Samoa",
    "Bolivia" = "Bolivia (Plurinational State of)",
    "Brunei" = "Brunei Darussalam",
    "Cape Verde" = "Cabo Verde",
    "Cote d'Ivoire" = "CÃ´te d'Ivoire",
    "Democratic Republic of Congo" = "Congo (Democratic Republic of the)",
    "Eswatini" = "Eswatini (Kingdom of)",
    "Iran" = "Iran (Islamic Republic of)",
    "Laos" = "Lao People's Democratic Republic",
    "Micronesia (country)" = "Micronesia (Federated States of)",
    "North Korea" = "Korea (Republic of)",
    "Northern Ireland" = "Ireland",
    "Palestine" = "Palestine, State of",
    "Russia" = "Russian Federation",
    "South Sudan" = "Sudan",
    "Syria" = "Syrian Arab Republic",
    "Timor" = "Timor-Leste",
    "Venezuela" = "Venezuela (Bolivarian Republic of)",
    "Vietnam" = "Viet Nam"
  ))
```

```{r preparing_for_plot}
# calculate the average death rate over 2008 to latest
selected_suicide_rates <- change %>%
  filter(Year > 2007) %>%
  group_by(Entity) %>%
  summarise(avg_rate = mean(
    `Deaths - Self-harm - Sex: Both - Age: Age-standardized (Rate)`))
```

```{r}
join <- full_join(selected_suicide_rates, tidied_hdi_data) %>%
  arrange(desc(avg_rate)) %>%
  na.omit() %>%
  rename(`Development status` = Degree_of_Human_Development) %>%
  mutate(avg_rate = round(avg_rate, digits = 2))
```


### Visualization for top 30 countries with maximum suicide rates

```{r}
plot1 <- join %>% head(30)
ggplot(plot1,
  aes(x = reorder(Entity, -avg_rate), y = avg_rate,
    fill = `Development status`)) +
  geom_col() +
  geom_text(aes(label = avg_rate), vjust = 2, colour = "white", size = 3) +
  theme(
    legend.position = "bottom",
    axis.text.x = element_text(angle = 45, vjust = 0.5, hjust = 1),
    plot.title = element_text(face = "bold")
  ) +
  labs(
    title = "Top 30 countries by average suicide rate (2008-2019)",
    x = substitute(paste(bold("Country"))),
    y = substitute(paste(bold("Suicide rate per 100,000 people")))
  ) +
  scale_fill_manual(
    values = c("#A0331C", "#1C56A0", "#4B902F", "#635A61"))
```

# Visualization 2

## India's Mental Health Act 2017

### Suicide Rates & reported mental health issues before and after 2017

Data source:WHO- https://www.who.int/data/gho/data/themes/mental-health/suicide-rates

```{r who_data}
who_data <-read_csv("data/InitialA1/data-2.csv") %>% 
  filter(Dim1=="Both sexes") %>% 
  select(SpatialDimValueCode, Location, Period, Dim1, FactValueNumeric)
```

### Visualization for India's suicide rates over time.

```{r plot2}
who_data %>% filter(Location=="India") %>% 
ggplot(aes(x=Period, y=FactValueNumeric))+
  geom_line()+
  geom_point(color = "brown", size = 1.5) +
  geom_vline(xintercept = 2017, linetype = "dashed") +
  scale_x_continuous(breaks = seq(from = 2000, to = 2019, by = 1)) +
  theme(
    legend.position = "none",
    axis.title = element_text(face = "bold"),
    plot.title = element_text(size = 14, lineheight = .8)
    )+
  xlab(NULL)+
  ylab(substitute(paste(bold("Rate per 100,000 people"))))+
  ggtitle("Time-series for India, 2000-2019")+
   theme(plot.title = element_text(size=14, lineheight=.8))+
  geom_vline(xintercept = 2017, linetype = "dashed")+
scale_color_manual(values=c('Brown','Purple', 'Black'))+
  theme(legend.position = "none")
```

# Visualization 3

## 2019 State/UT-wise India's suicide rate.

Data sources:

* Data.gov- https://data.gov.in/catalog/stateut-wise-distribution-suicides-causes
* http://www.diva-gis.org/datadown

```{r reading_region_wise_data_mapfiles}
options(scipen=999)

region_cases_2019 <- read_csv("data/InitialA1/RS_Session_253_A_211.1.csv") %>% 
  filter(str_detect(`State/UT`, "Total ", negate = TRUE)) %>% 
  select(`State/UT`, Total )

states_shape_sf <- read_sf("data/InitialA1/IND_adm/IND_adm1.shp") 

#matching ID's of both data
df_newid=data.frame(id=c(2,3,4, 5,7,11,12,13,14,15,16,17,18,20, 21,22,23,24,25,26, 28,29,30, 31,32,33,34, 35,36, 1, 6, 8,9,10,19, 27))

join_newid <- cbind(region_cases_2019, df_newid) %>% 
    mutate(id=as.numeric(id))

states_merged <- inner_join(states_shape_sf, join_newid,
  by = c("ID_1" = "id"))

```

### Map of India showing region wise suicide count in 2019.

```{r plot3}
colors <- c('#C6B7F7', "#744BF7", "#6B96EC", "#103E99")
b <- c(0, 10000, 18000, 140000)
ggplot() +
  geom_sf(
    aes(fill = Total),
    data = states_merged,
    color = "black",
    linewidth = 0.25
  )+
geom_sf_text(
    data = states_merged,
    aes(label = NAME_1),
    size = 3,
    color = "black",
    fontface = "bold"
  )+
  coord_sf() +
  scale_fill_fermenter(palette = "YlGnBu", direction = -1, trans = "log10",
    labels = scales::label_number_si()) +
  theme(
  axis.title = element_text(face = "bold"),
  panel.grid.major.x = element_blank(),
    panel.grid.minor.x = element_blank())+
  labs(title = "Region-wise 2019 data:India")
```


# Visulaization 4

Data source: WHO- https://www.who.int/data/gho/data/themes/mental-health/suicide-rates

### Countries with outliers in data

```{r outliers_indatacollection}
who_data %>% filter(Location %in% c( "Kiribati", "Central African Republic", "Latvia", "Republic of Korea", "Fiji", "Rwanda", "Poland", "Comoros", "Uzbekistan", "Bosnia and Herzegovina", "Grenada", "Niger", "Cuba", "Equatorial Guinea", "Burkina Faso", "Samoa", "Latvia", "Sao Tome and Principe", "Honduras", "Lebanon", "Maldives", "Bahamas", "Timor-Leste", "Iraq", "Dominican Republic", "Iran (Islamic Republic of)", "Brazil", "Bolivia (Plurinational State of)", "The former Yugoslav Republic of Macedonia", "Portugal", "Belize", "Serbia", "Mali", "Argentina", "United Republic of Tanzania", "Democratic People's Republic of Korea")) %>% 
  ggplot(aes(x = Location, y = FactValueNumeric, fill = Location)) +
  geom_boxplot() +
  theme(legend.position = "none") +
  scale_fill_viridis_d(alpha = 0.6) +
  theme(
    text = element_text(size = 8),
    axis.text.x = element_text(angle = 45, hjust = 1),
    axis.title = element_text(face = "bold"),
    plot.title = element_text(size = 14, lineheight = 8, face= "bold")
  ) +
  labs(
    x = "Country",
    y = "Suicide rate",
    title = "Irregularity in Data Collection"
  )

```

# Visulaization 5

## Data source
1. WHO- https://www.who.int/data/gho/data/themes/mental-health/suicide-rates

## South Asian countries-Suicide rate trend.

```{r}
filtered <- who_data %>% 
  filter(Location %in% c("India", "Maldives", "Afghanistan", "Nepal", "Bangladesh", "Bhutan", "Sri Lanka", "Pakistan"))

ggplot(filtered, aes(colour=Location, y=FactValueNumeric, x=Period ))+
  geom_line()+
  geom_point()+
  ylab("Suicide rate")+
  ggtitle("South Asian Countries")+
  scale_colour_brewer(type = "seq", palette = "Dark2")+
  theme_classic()
```

